import{l as h}from"./lodash.65b4c225.js";import{_,e as v,o as d,c,a as o,F as m,f as p,w as b,n as g,t as w,g as f,v as R,h as C,i as y}from"./index.94864657.js";const S={props:{boxRewards:Array,boxes:Array,storageKey:String},mounted(){let e=this.boxRewards.map(s=>s.name);this.boxes.flatMap(s=>s.items.itemNames).filter(s=>e.indexOf(s)===-1).forEach(s=>{console.warn("invalid: "+s)})},data(){var e,t,s,a;return{rewardGroups:h.exports.chain(this.boxRewards).groupBy(n=>n.type).map((n,i)=>({Key:i,Rewards:n})).sortBy(n=>n.Key).value(),possibleRewards:this.loadInitialRewardCount(),boxCounts:this.toItemCounter(this.boxes),boxesPerRow:(t=(e=this.loadState())==null?void 0:e.itemsPerRow)!=null?t:3,debouncedUpdate:h.exports.debounce(()=>{this.saveState()},2e3),showFractionalRewards:(a=(s=this.loadState())==null?void 0:s.showFractionalRewards)!=null?a:!1}},watch:{boxCounts:{handler(e,t){this.updateRewardCount(e),this.debouncedUpdate()},deep:!0}},computed:{boxColumn(){return"col-md-"+12/this.boxesPerRow},boxChunks(){return h.exports.chunk(this.boxes.map(e=>this.toCountableItem(e)),this.boxesPerRow)}},methods:{toItemCounter(e){var t=this.loadState();let s={};return e.forEach(a=>{s[a.name]=this.toCountableItem(a),t!==null&&t.boxCounts[a.name]&&(s[a.name].count=t.boxCounts[a.name].count)}),this.updateRewardCount(s),s},toCountableItem(e){return{name:e.name,items:e.items,count:0}},loadInitialRewardCount(){var s;let e=Object.assign({},...this.boxRewards.map(a=>({[a.name]:0}))),t=(s=this.loadState())==null?void 0:s.boxCounts;return t&&Object.entries(t).forEach(([a,n])=>{n.items.itemNames.forEach(i=>{e[i]+=n.items.unit*n.count})}),e},updateRewardCount(e){let t=Object.assign({},...this.boxRewards.map(s=>({[s.name]:0})));Object.entries(e).forEach(([s,a])=>{a.items.itemNames.forEach(n=>{t[n]+=a.items.unit*a.count})}),this.possibleRewards=t},displayRewardCount(e){return this.showFractionalRewards?e.toFixed(1):Math.floor(e)},saveState(){let e={itemsPerRow:this.boxesPerRow,boxCounts:this.boxCounts,showFractionalRewards:this.showFractionalRewards};window.localStorage.setItem(this.storageKey,JSON.stringify(e))},loadState(){let e=window.localStorage.getItem(this.storageKey);return e?JSON.parse(e):null},getTooltip(e){let t="";return this.possibleRewards[e.name]>0&&(t+=this.getBoxesTooltipSection(e)),e.events&&(t.length&&(t+="<hr>"),t+=this.getEventsTooltipSection(e)),t},getBoxesTooltipSection(e){let s=Object.values(this.boxCounts).map(l=>({name:l.name,count:l.count,items:l.items})).filter(l=>l.count>0&&l.items.itemNames.indexOf(e.name)!==-1),a=h.exports.sortBy(s,["items.itemNames.length","items.unit"],["asc","asc"]),n="<ul>",i=a.map(l=>l.count.toLocaleString()).sort((l,r)=>r.length-l.length)[0].length;return a.forEach(l=>{let r=Number.isInteger(l.count)?0:1,u=l.count.toFixed(r).toString()+" ";n+="<li>"+u.padStart(i+1,"\xA0")+l.name+"</li>"}),n+="</ul>",n},getEventsTooltipSection(e){let t="Events:";return t+="<ul>",e.events.sort().forEach(s=>{t+="<li>"+s+"</li>"}),t}}},I={class:"jumbotron text-center"},E={class:"card-group"},B={class:"card"},k={class:"card-text"},F=o("br",null,null,-1),N={class:"row mt-2"},P=["onUpdate:modelValue"],O=o("br",null,null,-1),T={class:"row"},j=o("p",null,[o("i",null,"This list is in the same order as items appear in your inventory. Some items are missing - message me if you know them. The values you enter here are saved in your browser, so you will be able to view them again later.")],-1),U=o("p",null,[o("i",null,"Hover/tap on an item count to see the boxes that contributed towards it, and where you can get them.")],-1),V={class:"col-md-3"},K={class:"form-group"},M=o("label",null,"Items per row",-1),H=o("option",null,"1",-1),A=o("option",null,"2",-1),D=o("option",{selected:""},"3",-1),z=o("option",null,"4",-1),G=[H,A,D,z],J={class:"form-check"},L=o("label",null,"Show fractional souls",-1);function q(e,t,s,a,n,i){const l=v("tooltip");return d(),c(m,null,[o("div",I,[(d(!0),c(m,null,p(n.rewardGroups,r=>(d(),c("div",null,[o("div",E,[(d(!0),c(m,null,p(r.Rewards,u=>b((d(),c("div",B,[o("div",{class:"card-body",style:g({"background-color":u.colour})},[o("div",k,[o("h1",null,w(i.displayRewardCount(n.possibleRewards[u.name])),1),o("h6",null,w(u.name),1)])],4)])),[[l,i.getTooltip(u),"bottom"]])),256))]),F]))),256))]),(d(!0),c(m,null,p(i.boxChunks,r=>(d(),c("div",null,[o("div",N,[(d(!0),c(m,null,p(r,u=>(d(),c("div",{class:f(i.boxColumn)},[o("label",null,w(u.name),1),b(o("input",{type:"number",class:"form-control","onUpdate:modelValue":x=>n.boxCounts[u.name].count=x,min:"0"},null,8,P),[[R,n.boxCounts[u.name].count]])],2))),256))])]))),256)),O,o("div",T,[j,U,o("div",V,[o("div",K,[M,b(o("select",{class:"form-control",onInput:t[0]||(t[0]=(...r)=>e.onEventSelected&&e.onEventSelected(...r)),"onUpdate:modelValue":t[1]||(t[1]=r=>n.boxesPerRow=r)},G,544),[[C,n.boxesPerRow]])]),o("div",J,[L,b(o("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=r=>n.showFractionalRewards=r)},null,512),[[y,n.showFractionalRewards]])])])])],64)}var X=_(S,[["render",q]]);export{X as B};
